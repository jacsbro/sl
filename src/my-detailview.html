<!-- import CSS mixin shim -->
<link rel="import" href="../bower_components/shadycss/apply-shim.html">
<!-- import Polymer.Element -->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-input/iron-input.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="sl-grid.html">

<dom-module id="my-detailview">

  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
      }
      .card {
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 16px;
        border-radius: 5px;
        background-color: var(--app-background-color);
        color: var(--app-text-color-light);
      }

      .margin {
        margin-top: 2rem;
      }

    </style>
    <custom-style>
      <style is="custom-style" include="iron-flex iron-flex-alignment iron-flex-factors"></style>
    </custom-style>

    <!-- options mode -->
    <div class="card" hidden$="{{!_isMenumode}}">
      <paper-checkbox id="my_detail_allneeded" on-change="_allNeeded" class="options">
        {{localize('allneeded')}}
        <span class="subtitle">
          {{localize('allneededhint')}}
        </span>
      </paper-checkbox>
      <paper-checkbox id="my_detail_allneededfalse" on-change="_allNeededfalse" class="options">
        {{localize('allneededfalse')}}
        <span class="subtitle">
          {{localize('allneededfalsehint')}}
        </span>
      </paper-checkbox>
      <hr></hr>
      <paper-checkbox id="my_detail_alldone" on-change="_allDone" class="options">
        {{localize('alldone')}}
        <span class="subtitle">
          {{localize('alldonehint')}}
        </span>
      </paper-checkbox>
      <paper-checkbox id="my_detail_alldonefalse" on-change="_allDonefalse" class="options">
        {{localize('alldonefalse')}}
        <span class="subtitle">
          {{localize('alldonefalsehint')}}
        </span>
      </paper-checkbox>
      <hr></hr>
      <div class="layout horizontal around-justified margin">
        <paper-button on-tap="_menuPressedOff">OK</paper-button>
      </div>
    </div>

    <!-- delete mode -->
    <div class="card" hidden$="{{!_isDeletemode}}">
      <h3>{{localize('confirmdelete', 'name', data.currentList.name)}}</h3>
      <div class="layout horizontal around-justified margin">
        <paper-button on-tap="_deleteList">{{localize('ok')}}</paper-button>
        <paper-button on-tap="_deletePressedOff">{{localize('cancel')}}</paper-button>
      </div>
    </div>

    <!-- normal mode mode -->
    <div class="card" hidden$="{{!_isEditMode(_isMenumode, _isDeletemode)}}">
      <paper-input label="{{localize('name')}}" value="{{data.currentList.name}}" on-change="_changed"></paper-input>
      <sl-grid id="myapp_slgrid" data="{{data.currentList}}"></sl-grid>
    </div>

  </template>

  <script>
    class MyDetailview extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], Polymer.Element) {
    
     static get is() { return 'my-detailview'; }

      static get properties() {
        return {
          // data we're bound to
          data: {
            type: Object,
            notify: true
          },
          // true if we are in menumode
          _isMenumode: {
            type: Boolean,
            value: false
          },
          // true if we are in deletemode
          _isDeletemode: {
            type: Boolean,
            value: false
          }
        };
      }

      /**
       * option to set everything to needed
       */
      _allNeeded(data) {
        var b = data.target.checked;
        if (b) {
          this._doAllBool(b, 'needed');
          this.$.my_detail_allneededfalse.checked = !b;
        }
      }

      /**
       * option to set everything to not needed
       */
      _allNeededfalse(data) {
        var b = data.target.checked;
        if (b) {
          this._doAllBool(!b, 'needed');
          this.$.my_detail_allneeded.checked = !b;
        }
      }

      /**
       * option to set everything to done
       */
      _allDone(data) {
        var b = data.target.checked;
        if (b) {
          this._doAllBool(b, 'done');
          this.$.my_detail_alldonefalse.checked = !b;
        }
      }

      /**
       * option to set everything to not done
       */
      _allDonefalse(data) {
        var b = data.target.checked;
        if (b) {
          this._doAllBool(!b, 'done');
          this.$.my_detail_alldone.checked = !b;
        }
      }

      _doAllBool(b, propName) {
        this.$.myapp_slgrid.handleMenuChanges(b, propName);
        // var theItems = this.data.currentList.items;
        // for( var i=0; i<theItems.length;i++) {
        //   var thePropName = 'data.currentList.items.' + i + "." + propName;
        //   this.set(thePropName, app.toBoolean(b));
        //   this._changed();
        // }
        this.savePressed();
      }
      
      addPressed(data) {
        this.$.myapp_slgrid.addPressed();
      }

      /**
       * menumode on/off
       */
      menuPressedOn() {
        this._isMenumode = true;
      }

      _menuPressedOff() {
        this._isMenumode = false;
        // do not preserve the state of these checkboxes
        this.$.my_detail_allneeded.checked = false;
        this.$.my_detail_allneededfalse.checked = false;
        this.$.my_detail_alldone.checked = false;
        this.$.my_detail_alldonefalse.checked = false;
        this.$.myapp_slgrid.endEdit();
      }

      _deleteList() {
        this.data.slstore.deleteList(this.data.currentList);
        this._deletePressedOff();
        app.setMainView();
      }

      /**
       * deletemode on/off
       */
       deletePressedOn() {
         this._isDeletemode = true;
       }

      _deletePressedOff() {
        this._isDeletemode = false;
      }

      /**
       * save
       */
      savePressed() {
        this.data.currentList.modified = new Date();
        this.data.slstore.save();
        this._saveNeeded(false);
      }

      _saveNeeded(b) {
        app.set('isSaveNeeded', b);
      }

      _changed() {
        this._saveNeeded(true);
      }

      /**
       * return true if we should are in normal editmode
       */
      _isEditMode(menumode, deletemode) {
        return menumode === false && deletemode === false;
      }

      // load localized messages
      attached() {
        app.I18Nregister(this);
      }

      ready() {
        super.ready();
        console.log("ready ");
      }
    }
    window.customElements.define(MyDetailview.is, MyDetailview);

  </script>

</dom-module>
